echo "Checking recent logs for MCP routes..."
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=emailpilot-api AND resource.labels.revision_name=emailpilot-api-00051-wqz" --limit=20 --format="value(textPayload)" | grep -i "mcp\|router\|api/mcp" || echo "No MCP references found in logs"
echo ""
echo "Checking if service is healthy:"
curl -s https://emailpilot-api-935786836546.us-central1.run.app/health
echo ""
echo "Let's deploy a simple Cloud Function as a workaround..."
cd ~
mkdir -p mcp-workaround
cd mcp-workaround
cat > index.js << 'EOF'
exports.mcpModels = (req, res) => {
  res.set('Access-Control-Allow-Origin', '*');
  res.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.set('Access-Control-Allow-Headers', '*');
  
  if (req.method === 'OPTIONS') {
    res.status(204).send('');
    return;
  }
  
  res.status(200).json([
    {id: 1, provider: 'claude', model_name: 'claude-3-opus', display_name: 'Claude 3 Opus'},
    {id: 2, provider: 'openai', model_name: 'gpt-4-turbo', display_name: 'GPT-4 Turbo'},
    {id: 3, provider: 'gemini', model_name: 'gemini-pro', display_name: 'Gemini Pro'}
  ]);
};

exports.mcpClients = (req, res) => {
  res.set('Access-Control-Allow-Origin', '*');
  res.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.set('Access-Control-Allow-Headers', '*');
  
  if (req.method === 'OPTIONS') {
    res.status(204).send('');
    return;
  }
  
  res.status(200).json([]);
};

exports.mcpHealth = (req, res) => {
  res.set('Access-Control-Allow-Origin', '*');
  res.status(200).json({
    status: 'healthy',
    mcp: 'active',
    timestamp: new Date().toISOString(),
    message: 'MCP Cloud Function Workaround Active'
  });
};
EOF
cat > package.json << 'EOF'
{
  "name": "mcp-workaround",
  "version": "1.0.0",
  "main": "index.js"
}
EOF
echo "Deploying MCP workaround functions..."
gcloud functions deploy mcp-models --runtime nodejs18 --trigger-http --allow-unauthenticated --entry-point mcpModels --region us-central1
gcloud functions deploy mcp-clients --runtime nodejs18 --trigger-http --allow-unauthenticated --entry-point mcpClients --region us-central1
gcloud functions deploy mcp-health --runtime nodejs18 --trigger-http --allow-unauthenticated --entry-point mcpHealth --region us-central1
echo ""
echo "Once deployed, your MCP endpoints will be available at:"
echo "  https://us-central1-emailpilot-438321.cloudfunctions.net/mcp-models"
echo "  https://us-central1-emailpilot-438321.cloudfunctions.net/mcp-clients"
echo "  https://us-central1-emailpilot-438321.cloudfunctions.net/mcp-health"