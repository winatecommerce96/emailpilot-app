<!DOCTYPE html>
<html>
<head>
    <title>Goals Test</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <div id="debug"></div>
    
    <script>
        window.API_BASE_URL = 'http://localhost:8000';
        
        function log(msg) {
            document.getElementById('debug').innerHTML += '<p>' + msg + '</p>';
            console.log(msg);
        }

        // Test the Goals API first
        async function testAPI() {
            try {
                const response = await axios.get('/api/goals/clients', {
                    withCredentials: true
                });
                log('✅ API Success: ' + JSON.stringify(response.data));
                return true;
            } catch (error) {
                log('❌ API Error: ' + error.message);
                return false;
            }
        }

        // Load Goals components and test
        function loadComponentsAndTest() {
            log('Loading Goals components...');
            
            // List of components to load
            const scripts = [
                '/static/dist/GoalsDashboard.js',
                '/static/dist/GoalsCompanyDashboard.js', 
                '/static/dist/GoalsEnhancedDashboard.js',
                '/static/dist/GoalsDataStatus.js',
                '/static/dist/GoalGeneratorPanel.js'
            ];
            
            let loaded = 0;
            scripts.forEach((src, index) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    loaded++;
                    log(`Loaded ${src}`);
                    
                    if (loaded === scripts.length) {
                        // All components loaded, now test
                        testComponents();
                    }
                };
                script.onerror = () => {
                    log(`Failed to load ${src}`);
                };
                document.head.appendChild(script);
            });
        }
        
        function testComponents() {
            log('Testing component availability...');
            
            const components = [
                'GoalsDashboard',
                'GoalsCompanyDashboard', 
                'GoalsEnhancedDashboard',
                'GoalsDataStatus',
                'GoalGeneratorPanel'
            ];
            
            let allPresent = true;
            components.forEach(comp => {
                if (window[comp]) {
                    log(`✅ ${comp} available`);
                } else {
                    log(`❌ ${comp} NOT available`);
                    allPresent = false;
                }
            });
            
            if (allPresent) {
                // Try to render a Goals component
                try {
                    const testElement = React.createElement('div', {}, 'Testing Goals...');
                    ReactDOM.render(testElement, document.getElementById('root'));
                    log('✅ React rendering works');
                    
                    // Now try to render the actual Goals component
                    if (window.GoalsCompanyDashboard) {
                        const goalsElement = React.createElement(window.GoalsCompanyDashboard, {
                            user: { email: 'test@emailpilot.ai' },
                            authToken: 'test'
                        });
                        ReactDOM.render(goalsElement, document.getElementById('root'));
                        log('✅ GoalsCompanyDashboard rendered successfully!');
                    }
                } catch (error) {
                    log('❌ React rendering error: ' + error.message);
                    console.error(error);
                }
            }
        }
        
        // Start the test
        window.addEventListener('load', async () => {
            log('Starting Goals test...');
            
            const apiWorks = await testAPI();
            if (apiWorks) {
                loadComponentsAndTest();
            } else {
                log('API test failed, but continuing with component test...');
                loadComponentsAndTest();
            }
        });
    </script>
</body>
</html>