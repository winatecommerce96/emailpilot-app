INFO:     Started server process [2596]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:9090 (Press CTRL+C to quit)
INFO:     127.0.0.1:52790 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,797.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:52815 - "GET /clients/rogue-creamery/revenue/last7?timeframe_key=last_7_days&recompute=true HTTP/1.1" 200 OK
INFO:     127.0.0.1:52960 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52962 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52962 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52962 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52962 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52962 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52993 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52962 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52962 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53012 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53024 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53244 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53266 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53266 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53266 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53266 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53266 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53302 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $1,619.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $0.00
INFO:     127.0.0.1:53266 - "GET /clients/rogue-creamery/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $658.40
INFO:     127.0.0.1:53266 - "GET /clients/rogue-creamery/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:     127.0.0.1:53437 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $85.50
INFO:     127.0.0.1:53439 - "GET /clients/vlasic-labs/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $89.99
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $262.03
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $43.23
INFO:     127.0.0.1:53474 - "GET /clients/vlasic-labs/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $209.46
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $162.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 5.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $597.36
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 5.0 seconds...
INFO:     127.0.0.1:53526 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $0.00
INFO:     127.0.0.1:53528 - "GET /clients/wheelchair-getaways/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $0.00
INFO:     127.0.0.1:53528 - "GET /clients/wheelchair-getaways/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $41.88
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 10.0 seconds...
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $0.00
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 15.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 15.0 seconds...
INFO:     127.0.0.1:53700 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $1,619.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $0.00
INFO:     127.0.0.1:53702 - "GET /clients/rogue-creamery/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $658.40
INFO:     127.0.0.1:53702 - "GET /clients/rogue-creamery/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $162.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $597.36
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on flow report, waiting 15.0 seconds...
INFO:     127.0.0.1:54022 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54024 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54026 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54026 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54026 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54064 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54026 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54026 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54071 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54086 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54086 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54086 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54086 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54086 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54115 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54026 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54026 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54153 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54026 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54086 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54026 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54086 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54026 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54086 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54086 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54296 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54639 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54641 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54643 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54643 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54643 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54643 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54643 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54681 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54643 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54643 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54643 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54643 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54756 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55044 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55046 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55065 - "GET /clients/PXPdTiHtJmvdLoxHIgrT/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $851.23
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:55077 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:     127.0.0.1:55433 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55466 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55468 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55468 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55468 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55468 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:     127.0.0.1:55468 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:services.revenue_api.main:Flow total: $562.61
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $502.00
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:     127.0.0.1:55498 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55468 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55468 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55550 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55552 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55819 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55821 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55824 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55835 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55836 - "OPTIONS /clients/test/revenue/last7 HTTP/1.1" 200 OK
INFO:     127.0.0.1:55824 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55824 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55824 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55824 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55885 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55886 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55891 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55892 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55905 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:55911 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55891 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55936 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:55988 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:55989 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56272 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:56274 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56310 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:56312 - "GET /clients/enhanced-api-test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:56314 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:56321 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56321 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:     127.0.0.1:56321 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56321 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56321 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:     127.0.0.1:56361 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56321 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56321 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:56329 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56321 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56321 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56445 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a84a0f0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
    r = await client.post(f"{base}/campaign-values-reports/", headers=headers, json=campaign_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:     127.0.0.1:56661 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:56714 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:56716 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:56718 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56718 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56718 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56718 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56718 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:56748 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56718 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56718 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56718 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56718 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:56805 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:56933 - "GET /clients/rogue-creamery/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:     127.0.0.1:56943 - "GET /clients/vlasic-labs/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:     127.0.0.1:56958 - "GET /clients/wheelchair-getaways/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:57002 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:57016 - "GET /clients/rogue-creamery/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:     127.0.0.1:57025 - "GET /clients/vlasic-labs/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:     127.0.0.1:57039 - "GET /clients/wheelchair-getaways/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:     127.0.0.1:57049 - "GET /clients/golden-gate-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:57056 - "GET /clients/sf-coffee-roasters/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:57063 - "GET /clients/test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:57141 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57144 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57146 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57146 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57146 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57146 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57146 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57184 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57146 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57146 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57146 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57146 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57245 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57451 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57456 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57468 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57471 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57472 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57474 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57472 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57474 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57472 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57474 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57472 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57474 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57472 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57474 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57559 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57472 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57574 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:services.revenue_api.main:Flow total: $502.00
INFO:     127.0.0.1:58445 - "GET /clients/colorado-hemp-honey/revenue/last7 HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:     127.0.0.1:58447 - "GET /clients/consumer-law-attorneys/revenue/last7 HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:58472 - "GET /clients/first-aid-supplies-online/revenue/last7 HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $203.96
INFO:     127.0.0.1:58505 - "GET /clients/milagro-mushrooms/revenue/last7 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58548 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:58550 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:58558 - "GET /clients/enhanced-api-test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:58565 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:     127.0.0.1:58596 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $502.00
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:     127.0.0.1:58625 - "GET /clients/vlasic-labs/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $203.96
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:     127.0.0.1:58674 - "GET /clients/wheelchair-getaways/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:     127.0.0.1:58724 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:58726 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:58734 - "GET /clients/enhanced-api-test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:58741 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:     127.0.0.1:58753 - "GET /clients/colorado-hemp-honey/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:     127.0.0.1:58783 - "GET /clients/consumer-law-attorneys/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:     127.0.0.1:58819 - "GET /healthz HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:     127.0.0.1:58821 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:58829 - "GET /clients/enhanced-api-test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $502.00
INFO:     127.0.0.1:58797 - "GET /clients/first-aid-supplies-online/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:     127.0.0.1:58898 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a106330

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
    r = await client.post(f"{base}/campaign-values-reports/", headers=headers, json=campaign_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a8532f0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 244, in _sum_campaign_flow
    r = await client.post(f"{base}/flow-values-reports/", headers=headers, json=flow_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a8797f0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
    r = await client.post(f"{base}/campaign-values-reports/", headers=headers, json=campaign_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a827d10

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 324, in revenue_last7
    metric_id = await _find_best_placed_order_metric(klaviyo_key)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 163, in _find_best_placed_order_metric
    r = await client.get(f"{base}/metrics/?fields[metric]=name", headers=headers)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1768, in get
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a87ae40

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
    r = await client.post(f"{base}/campaign-values-reports/", headers=headers, json=campaign_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a865160

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
    r = await client.post(f"{base}/campaign-values-reports/", headers=headers, json=campaign_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a8275f0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
    result = await _sum_campaign_flow(klaviyo_key, metric_id, tf_payload)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
    r = await client.post(f"{base}/campaign-values-reports/", headers=headers, json=campaign_payload)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $203.96
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:     127.0.0.1:59187 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:59195 - "GET /clients/enhanced-api-test-client/revenue/last7?recompute=true HTTP/1.1" 404 Not Found
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:59202 - "GET /clients/christopher-bean-coffee/revenue/last7?recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 15.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:59215 - "GET /clients/rogue-creamery/revenue/last7?recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:     127.0.0.1:59738 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:59757 - "GET /clients/rogue-creamery/revenue/last7?recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:59913 - "GET /clients/rogue-creamery/revenue/last7 HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:     127.0.0.1:59915 - "GET /clients/vlasic-labs/revenue/last7 HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $203.96
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $502.00
INFO:     127.0.0.1:60379 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:60381 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:60389 - "GET /clients/enhanced-api-test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:60389 - "GET /clients/PXPdTiHtJmvdLoxHIgrT/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:60406 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:     127.0.0.1:60420 - "GET /clients/colorado-hemp-honey/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:     127.0.0.1:60434 - "GET /clients/consumer-law-attorneys/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:     127.0.0.1:60491 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $203.96
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:services.revenue_api.main:Flow total: $502.00
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:     127.0.0.1:61314 - "GET /admin/mcp/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:61314 - "POST /admin/mcp/start HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/concurrency.py", line 37, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 628, in admin_mcp_start
    inst.start()
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 553, in start
    self._send({"jsonrpc": "2.0", "method": "notifications/initialized"}, expect_response=False)
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 573, in _send
    self.proc.stdin.write(_json.dumps(obj) + "\n")
BrokenPipeError: [Errno 32] Broken pipe
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $855.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,394.90
INFO:     127.0.0.1:61318 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:     127.0.0.1:61353 - "GET /clients/colorado-hemp-honey/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:     127.0.0.1:61371 - "GET /clients/consumer-law-attorneys/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $502.00
INFO:     127.0.0.1:61386 - "GET /clients/first-aid-supplies-online/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $28,886.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:     127.0.0.1:61431 - "GET /clients/vlasic-labs/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $203.96
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,436.12
INFO:services.revenue_api.main:Fetching campaign values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric RvzbZi...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $440.00
INFO:     127.0.0.1:61474 - "GET /clients/wheelchair-getaways/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:     127.0.0.1:52321 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52323 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52325 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52330 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52347 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52348 - "OPTIONS /clients/test/revenue/last7 HTTP/1.1" 200 OK
INFO:     127.0.0.1:52325 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52352 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52325 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52359 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52325 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52359 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52325 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52359 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52359 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52359 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52408 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52325 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52420 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52325 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52359 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52325 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52359 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52325 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52359 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52325 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52359 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:      - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52887 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52889 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:52891 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52891 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52891 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52891 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52891 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:52924 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52891 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52891 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52891 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52967 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:52969 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53099 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53102 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53104 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53104 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53104 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53104 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53104 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53134 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53104 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53104 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53104 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53104 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53191 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53288 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53290 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53292 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53292 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53292 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53292 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53292 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53322 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53292 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53292 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53292 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53292 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53292 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53400 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $164.37
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $487.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $303.91
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $293.34
INFO:     127.0.0.1:53417 - "GET /clients/christopher-bean-coffee/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $447.17
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $281.65
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $152.96
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $151.13
INFO:     127.0.0.1:53540 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53542 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53544 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53544 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53544 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53544 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53544 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53574 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53544 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53544 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53544 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53544 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53631 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53707 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53709 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53711 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53711 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53711 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53711 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53711 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53743 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53711 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53711 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53770 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53772 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53776 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53881 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53883 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:53885 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53885 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53885 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53885 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53885 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:53916 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53885 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53885 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53885 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53885 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:53885 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54054 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54056 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:54058 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54058 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54058 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54058 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54058 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54091 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54058 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54058 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54118 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54120 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:54122 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57086 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57088 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57090 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57090 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57090 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57119 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57090 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57090 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57141 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57153 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57153 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57153 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57153 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57153 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57170 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57090 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57090 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57198 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57090 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57153 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57090 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57153 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57090 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57153 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57306 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57310 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57552 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57557 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57559 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57561 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:57563 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57565 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57563 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57565 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57563 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57565 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57563 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57565 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57563 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57565 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57621 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57563 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57628 - "GET /healthz HTTP/1.1" 200 OK
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57563 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57565 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-17T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57563 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57565 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-16T00%3A00%3A00Z&end=2025-08-16T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57563 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57565 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-15T00%3A00%3A00Z&end=2025-08-15T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57563 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57565 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-14T00%3A00%3A00Z&end=2025-08-14T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
/opt/anaconda3/lib/python3.12/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
INFO:     127.0.0.1:57565 - "GET /clients/by-slug/enhanced-api-test-client/revenue/last7?start=2025-08-13T00%3A00%3A00Z&end=2025-08-13T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:57763 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $164.37
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:     127.0.0.1:57792 - "GET /healthz HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $164.37
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $303.91
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $303.91
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 115, in fail_after
    yield cancel_scope
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    stream: anyio.abc.ByteStream = await anyio.connect_tcp(
                                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 235, in connect_tcp
    async with create_task_group() as tg:
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 776, in __aexit__
    raise exc_val
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_sockets.py", line 240, in connect_tcp
    await event.wait()
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 1774, in wait
    await self._event.wait()
  File "/opt/anaconda3/lib/python3.12/asyncio/locks.py", line 212, in wait
    await fut
asyncio.exceptions.CancelledError: Cancelled by cancel scope 10a879460

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 10, in map_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 113, in connect_tcp
    with anyio.fail_after(timeout):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_core/_tasks.py", line 118, in fail_after
    raise TimeoutError
TimeoutError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 268, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 251, in handle_async_request
    response = await connection.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_async/connection.py", line 124, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 112, in connect_tcp
    with map_exceptions(exc_map):
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 329, in revenue_last7
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 216, in _sum_campaign_flow
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/opt/anaconda3/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectTimeout
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 5.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $487.68
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $447.17
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $293.34
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 429 Too Many Requests"
WARNING:services.revenue_api.main:Rate limited on campaign report, waiting 10.0 seconds...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $447.17
INFO:     127.0.0.1:58294 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:58302 - "GET /healthz HTTP/1.1" 200 OK
INFO:     127.0.0.1:58304 - "GET /admin/mcp/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:58304 - "POST /admin/mcp/start HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 411, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 69, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 126, in __call__
    await super().__call__(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/fastapi/routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/starlette/concurrency.py", line 37, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 628, in admin_mcp_start
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 553, in start
  File "/Users/Damon/klaviyo/klaviyo-audit-automation/emailpilot-app/services/revenue_api/main.py", line 573, in _send
BrokenPipeError: [Errno 32] Broken pipe
INFO:     127.0.0.1:58308 - "GET /clients/NlqSaqGB8UQ2x3r48baS/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:58316 - "GET /clients/enhanced-api-test-client/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 404 Not Found
INFO:services.revenue_api.main:Fetching campaign values report for metric UVBrHm...
INFO:     127.0.0.1:58353 - "OPTIONS /clients/test/revenue/last7 HTTP/1.1" 200 OK
INFO:services.revenue_api.main:Fetching campaign values report for metric XhnHGe...
INFO:httpx:HTTP Request: GET https://a.klaviyo.com/api/metrics/?fields[metric]=name "HTTP/1.1 200 OK"
INFO:     127.0.0.1:58382 - "GET /clients/consumer-law-attorneys/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $344.44
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $903.26
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching campaign values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching flow values report for metric XhnHGe...
INFO:services.revenue_api.main:Fetching flow values report for metric UVBrHm...
INFO:services.revenue_api.main:Fetching campaign values report for metric Yh7ZSV...
INFO:     127.0.0.1:58475 - "GET /clients/nnNjrbpYTs2a4lypoER1/revenue/last7?start=2025-08-10T00%3A00%3A00Z&end=2025-08-17T23%3A59%3A59Z&recompute=true HTTP/1.1" 400 Bad Request
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $710.76
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $2,639.48
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $0.00
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $461.31
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching campaign values report for metric TPWsCU...
INFO:services.revenue_api.main:Fetching flow values report for metric Yh7ZSV...
INFO:services.revenue_api.main:Fetching flow values report for metric N8Uiwv...
INFO:services.revenue_api.main:Fetching campaign values report for metric SLCTyy...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $502.00
INFO:services.revenue_api.main:Flow total: $203.96
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $574.42
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/campaign-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Campaign total: $29,293.18
INFO:services.revenue_api.main:Waiting 3 seconds before flow report to avoid rate limiting...
INFO:services.revenue_api.main:Fetching flow values report for metric SLCTyy...
INFO:services.revenue_api.main:Fetching flow values report for metric TPWsCU...
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $562.61
INFO:httpx:HTTP Request: POST https://a.klaviyo.com/api/flow-values-reports/ "HTTP/1.1 200 OK"
INFO:services.revenue_api.main:Flow total: $5,629.12
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2596]
