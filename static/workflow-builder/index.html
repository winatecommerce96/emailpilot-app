<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Workflow Builder (Isolated)</title>
    <style>
      :root { color-scheme: light; }
      html, body { margin:0; padding:0; background:#f8fafc; color:#111827; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
      .wrap { max-width: 980px; margin: 24px auto; padding: 16px; background:#fff; border:1px solid #e5e7eb; border-radius: 12px; isolation: isolate; }
      .muted { color:#374151 }
      .btn { background:#fff; border:1px solid #e5e7eb; border-radius:8px; padding:8px 12px; cursor:pointer }
      .btn-primary { background:#2563eb; color:#fff; border:none }
      textarea { width:100%; min-height: 200px; }
      pre { background:#0f172a; color:#e2e8f0; padding:12px; border-radius:8px; overflow:auto }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Workflow Builder (Light)</h1>
      <p class="muted">This builder is isolated; no host CSS can affect it.</p>
      <div style="display:flex; gap:16px; align-items:center; margin: 12px 0">
        <button class="btn" id="load">Load /workflow/workflow.json</button>
        <button class="btn" id="save">Download workflow.json</button>
        <button class="btn btn-primary" id="codegen">Generate Code (CLI)</button>
      </div>
      <textarea id="editor" placeholder="Paste or edit workflow.json here..."></textarea>
      <h3>Validation</h3>
      <pre id="log">Ready.</pre>
    </div>
    <script>
      (function(){
        const ed = document.getElementById('editor');
        const log = document.getElementById('log');
        function setLog(msg){ log.textContent = msg; }
        document.getElementById('load').onclick = async ()=>{
          try {
            const res = await fetch('/workflow/workflow.json', { cache:'no-store' });
            if(!res.ok) throw new Error(res.status);
            ed.value = await res.text();
            setLog('Loaded workflow/workflow.json');
          } catch(e){ setLog('Load failed: '+e); }
        };
        document.getElementById('save').onclick = ()=>{
          try {
            const blob = new Blob([ed.value||''], {type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'workflow.json';
            a.click();
            setLog('Downloaded workflow.json');
          } catch(e){ setLog('Save failed: '+e); }
        };
        document.getElementById('codegen').onclick = ()=>{
          setLog('Run: python tools/codegen.py\nThen: python tools/run_graph.py --brand "Buca di Beppo" --month 2025-10');
        };
      })();
    </script>
  </body>
  </html>

