<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Execution Test</title>
</head>
<body>
    <h1>Testing Workflow Execution Fix</h1>
    <p>This page will test that the workflow execution properly handles the workflow ID.</p>
    
    <div id="results"></div>
    
    <script>
        // Simulate the workflow execution scenario
        let currentWorkflowId = 'calendar_workflow';
        let currentWorkflowData = {
            id: 'calendar_workflow',
            name: 'Calendar Planning'
        };
        
        function closeExecutionModal() {
            console.log('Closing modal - setting IDs to null');
            currentWorkflowId = null;
            currentWorkflowData = null;
        }
        
        async function oldVersion() {
            console.log('=== Testing OLD version ===');
            console.log('Before close:', currentWorkflowId);
            
            closeExecutionModal();
            
            console.log('After close:', currentWorkflowId); // Will be null
            
            if (currentWorkflowId) {
                console.log('Would execute with ID:', currentWorkflowId);
            } else {
                console.log('ERROR: No workflow ID available!');
            }
        }
        
        async function newVersion() {
            console.log('\n=== Testing NEW version ===');
            
            // Reset for test
            currentWorkflowId = 'calendar_workflow';
            currentWorkflowData = {
                id: 'calendar_workflow',
                name: 'Calendar Planning'
            };
            
            // Store workflow data before any modal changes
            const workflowId = currentWorkflowId;
            const workflowData = currentWorkflowData;
            
            console.log('Stored ID before close:', workflowId);
            
            closeExecutionModal();
            
            console.log('After close, current ID:', currentWorkflowId); // Will be null
            console.log('But stored ID is:', workflowId); // Still has value
            
            if (workflowId) {
                console.log('SUCCESS: Would execute with stored ID:', workflowId);
            } else {
                console.log('ERROR: No workflow ID available!');
            }
        }
        
        // Run tests
        async function runTests() {
            await oldVersion();
            await newVersion();
            
            const results = document.getElementById('results');
            results.innerHTML = `
                <h2>Test Results:</h2>
                <p><strong>Old Version:</strong> ❌ Workflow ID lost after closing modal</p>
                <p><strong>New Version:</strong> ✅ Workflow ID preserved using local variable</p>
                <p>Check browser console for detailed output.</p>
            `;
        }
        
        runTests();
    </script>
</body>
</html>